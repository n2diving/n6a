<% month = params[:rate_period] %>
<div class="row">
  <div class="col-xs-12 col-sm-10 col-sm-offset-1">
    <h1 class="margin-bottom-lg">team reviews</h1>

    <div class="row margin-bottom-lg">
      <div class="col-xs-12">
        <%= select_tag :rate_period, options_for_select(options_for_rate_period, month.blank? ? ((Date.today - 1.month).end_of_month) : month.to_date.end_of_month), include_blank: "select rate period", class: "form-control", id: "rate_period" %>
      </div>
    </div>

    <table class="table table-striped table-hover table-bordered sortable">
      <thead>
      <tr>
        <th>team</th>
        <th class="text-center">rate period</th>
        <th class="text-center">actions</th>
      </tr>
      </thead>

      <tbody>
      <% rate_period = month.try(:to_date) || (Date.today - 1.month) %>
      <% rate_period_reviews = @user_reviews.where(rate_period: rate_period) %>
      <% if rate_period_reviews.any? %>
        <% @team_list.each do |one_team| %>
          <tr>
            <td><%= link_to one_team.team_name, one_team %></td>
            <td class="text-center"><%= rate_period.strftime("%B %Y") %></td>

            <td class="text-center">
              <%= link_to edit_team_rating_path(one_team.employee_teams.first.user_id, rate_period: rate_period) do %>
                <i class="fa fa-edit text-primary"></i> add team response notes
              <% end %>
              <%#= link_to user_review, method: :delete, data: { confirm: 'Are you sure?' } do %>
              <!--<i class="fa fa-trash text-danger"></i>-->
              <%# end %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="15"><em>There are no pending reviews for this month.</em></td>
        </tr>
      <% end %>
      </tbody>
    </table>

    <%#= paginate @user_reviews, theme: "twitter-bootstrap-3" %>
  </div>
</div>

<script>
  $(function(){
    $('select#rate_period').on('change', function () {
      var url = $(this).val();
      if (url) {
        window.location = "?rate_period="+url.split('%')[0];
      }
      return false;
    });
  });
</script>