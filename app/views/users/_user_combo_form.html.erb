<%= form_tag employee_rating_path do %>

  <div class="row">
    <div class="col-xs-12">
      <%= select_tag :id, options_for_select( @users.all.collect { |u| [ u.full_name, u.id ] }, params[:id]), include_blank: "employee name", class: "form-control margin-bottom-sm", required: true %>

      <%= select_tag :rate_period, options_for_select(options_for_rate_period), include_blank: "select rate period", class: "form-control margin-bottom-md", id: "rate_period", required: true %>
    </div>
  </div>

  <hr class="margin-none">


  <% @user.each do |one_user| %>
    <% @review_items.each_with_index do |review_item, i| %>
      <%= fields_for "user_reviews[]", one_user do |review_form| %>
        <div class="row">
          <div class="col-xs-12">
            <%#= review_form.select :rate_period, options_for_rate_period, { prompt: 'select rate period' }, class: "form-control margin-bottom-md" %>
            <h4 class="text-primary"><%= review_item.name %></h4>
            <p><%= review_item.evaluation_criteria %></p>
            <%= hidden_field_tag "user_reviews[#{i}][review_item_id]", value: review_item.id %>
            <%= hidden_field_tag "user_reviews[#{i}][rate_period]", '', class: "rate_period" %>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12 col-sm-6">
            <%= text_area_tag "user_reviews[#{i}][pros]", '', class: "form-control margin-bottom-md", placeholder: "pros", required: true%>
          </div>
          <div class="col-xs-12 col-sm-6">
            <%= text_area_tag "user_reviews[#{i}][cons]", '', class: "form-control margin-bottom-md", placeholder: "cons", required: true %>
          </div>
          <div class="col-xs-12">
            <% if true #current_user.is_admin %>
              <%= select_tag "user_reviews[#{i}][rating]", options_for_select(review_item.scale_min..review_item.scale_max), include_blank: "rating", class: "form-control margin-bottom-md", id: "rate_period" %>
            <% end %>

            <%= review_form.hidden_field :rated_by_user_id, value: current_user.id %>
          </div>
        </div>
      <% end%>
      <hr>
    <% end %>
  <% end %>


  <div class="row">
    <div class="col-xs-12">
      <%= submit_tag "save", class: "btn btn-primary btn-center" %>
    </div>
  </div>

<% end %>

<script>
  $( document ).ready(function() {
    $('#rate_period').on('change', function () {
      var period = this.value;
      $(".rate_period").each(function () {
        this.value = period;
      });
    });
    $('select#id').on('change', function () {
      var url = $(this).val();
      if (url) {
        window.location = url;
      }
      return false;
    });
  });
</script>
